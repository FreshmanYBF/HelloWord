======================
	Web主机托管
======================

对内容资源的存储、协调以及管理的职责 —— Web主机托管 
	（1）不同的网站如何被 “虚拟地托管” 在同一个服务器上，对HTTP会产生怎样的影响
	（2）在很大的流量压力下，如何确保网站更可靠
	（3）如何使网站加载更快
	
1、主机托管服务

并不是每个人都有能力和时间来搭建带有空调的服务器机房，注册域名，或购买网络带宽

主机托管提供Web主机硬件资源，以及管理Web站点的软件资源

2、虚拟主机托管

虚拟主机：在一台物理设备上虚拟出多台主机，共享硬件
服务器集群：托管这创建多个虚拟服务器提供服务，把负载分摊到群里的服务器上

（1）虚拟服务器请求缺乏主机信息
请求发送到哪个虚拟主机上

（2）识别虚拟主机
	通过URL路径进行虚拟主机托管 —— 路径中增加主机信息
		
	通过端口号进行主机托管 —— 为每个站点分配不同的端口号
		终端用户并不乐意指定或记忆端口号
	通过IP地址进行主机托管 —— 为不同的站点分配专门的IP地址
		每个虚拟网站分配一个或多个IP地址 —— IP地址有限
	通过Host首部进行主机托管
		Host: host:port 
			URL中包含IP，则Host首部应当包含同样的地址
			URL中包含主机名，则Host首部包含同样的主机名
			客户端显式地使用代理服务器，则Host首部应该使用原始服务器
			HTTP/1.1服务器必须用 400 状态码响应所有缺少Host首部字段的HTTP/1.1请求报文
			
3、使网站更可靠

	宕机，网络堵塞，网络掉线
	
（1）镜像的服务器集群
	主原始服务器
	复制原始服务器
		主和复制连接到网络交换机上，客户端的所有请求先到达网路交换机，再转发到某个服务器上
		将客户端请求导向特定服务器的方法：（1）HTTP重定向（2）DNS重定向 —— DNS服务器解析URL选择发送给客户端的IP地址
	
（2）内容分发网络（CDN）
	对特定内容进行分发的专门网络 —— 网络中的节点可以是Web服务器，反向代理或缓存
		复制服务器可以用反向代理缓存来代替 —— 反向代理不会存储主原始服务器的全部副本，而是只保存客户端请求的内容
											  原始服务器不负责更新它们内容，反向代理可以 ”预取“ 热点内容
											  
4、让网站更快
	集群，分布式代理缓存，反向代理服务器 —— 分散流量
	分发内容 —— 缩短距离，让内容更靠近终端用户



	
	
	
======================
	发布系统
======================

1、Web内容发布技术

FrontPage 2007年停止更新

采用RPC调用 —— FrontPage客户端发送GET请求获取RPC方法
			   FrontPage发送POST请求发送RPC方法和参数
			   服务器进行执行RPC方法，并返回执行结果
			   
WebDAV与协作写作 —— Web Distributed Authoring and Versioning 分布式写作和版本管理
	（1）WebDAV定义了一些新的HTTP方法，用来完成分布式写作开发，除了增删改，还有上锁解锁
	（2）XML：使用XML格式文件来关联方法的一些信息。
			习惯上会把XML文档里引用的方案定义保存在一个DTD（Document Type Definition，文档类型和定义）文件中
			试图解析XML文档时，可以根据其中的DOCTYPE定义项得到和这份XML文档相关的DTD文件名
			
	（3）WebDAV新增了一些HTTP首部，来增强新方法的功能
	
	


	
	
	
	
======================
	重定向与负载均衡
======================
	
重定向技术
	HTTP重定向：负载均衡，最短路径
	DNS重定向：DNS服务器决定在URL的主机名中返回多个IP地址中的哪一个
	任播路由：几台服务器使用相同的IP地址
	策略路由
	IP MAC转发：MAC-端口转发表
	IP 地址转发：IP-IP-端口转发表 
	WCCP(Web缓存协调协议)：路由器会评估一个分组的目的地址，并用代理或镜像服务器的IP地址将重定向分组封装起来
	ICP(缓存间通信协议)：代理缓存会在一组兄弟代理缓存中查询所请求的内容
	HTCP(超文本缓存协议)：参与的代理缓存可向一组兄弟缓存查询所i请求的内容
	NECP(网元控制协议)：
	CARP(缓存阵列路由协议)：一种代理缓存散列协议。允许缓存将请求转发给一个父缓存
	WPAD(Web代理自动发现协议)
	
1、为什么要重定向
HTTP应用程序必做
	（1）可靠地执行HTTP事务
	（2）最小化时延
	（3）节约网络带宽
	
分布：提高容灾性，就近服务器可以降低时延，分散可以减少网络拥塞

	
2、重定向到何地

对于客户端来说，服务器，代理，缓存和网关都是服务器。
	重定向到哪里？
		Web服务器会根据每个IP来处理请求
		代理则希望根据每个协议来处理请求 
			理想情况下，某个代理附近的所有HTTP流量都应该通过这个代理
			避免通过更长，更昂贵的路由连接到原始服务器
			
3、重定向协议概览

重定向的目标是尽快地将HTTP报文发送到可用的Web服务器上去
	在穿过因特网的路径时，HTTP报文传输的方向会收到HTTP应用程序和报文经由的路由设备的影响
		客户端代理，DNS解析，路由器，HTTP重定向
		
4、通用的重定向方法

HTTP重定向，DNS重定向，任播寻址，IP MAC转发以及IP 地址转发 

（1）DNS重定向 
DNS允许几个IP地址关联到一个域中，可以配置DNS解析程序，或对其进行编程，以返回可变的IP地址
	解析程序返回IP地址时所基于的原则可以很简单（轮转），也可以很复杂（负载均衡） 
	
由于大多数DNS客户端只使用第一个地址，所以DNS轮转可以在多台服务器间提供负载均衡
	有的客户端会缓存解析的地址，从而总与某个服务器哦你更新
	而有些服务器也更愿意保持与同一台客户端的联系

DNS的重定向算法
	负载均衡算法 —— DNS服务器会跟踪Web服务器上的负载，将负载最轻的服务器列表放在前面
	邻接路由算法 —— 服务器集群在地理上分散式，DNS服务器会尝试将用户导向最近的Web服务器
	故障屏蔽算法 —— DNS服务器可以监视网络状况，并将请求绕过出现服务中断或其他故障的地方


5、代理的重定向方法

客户端怎么才会知道要连接到某个代理上去呢？
	（1）显式的浏览器配置
	（2）动态自动配置
	（3）透明拦截
	
（1）显式浏览器配置

（2）代理自动配置
代理自动配置协议(PAC)
	让浏览器去获取一个称为PAC的特殊文件，这个文件说明了每个URL所关联的代理
	必须配置浏览器，为这个PAC文件关联一个特定的服务器

		

		
======================		
日志记录与使用情况跟踪
======================

1、记录内容

	HTTP方法
	客户端与服务器的HTTP版本
	所请求资源的URL
	响应的HTTP状态码
	请求和响应的报文的尺寸
	事务开始时的时间戳
	Referer首部和User-Agent首部的值
	
2、日志格式

3、命中率测量

RFC 2227 命中率测量协议


